<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯”ä¾‹å°ºå¤§æŒ‘æˆ° | Jessie Math</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           ğŸ¨ å“ç‰Œé¡è‰²è¨­å®šå€ (è«‹åœ¨æ­¤ä¿®æ”¹ä»¥ç¬¦åˆæ‚¨çš„ç¶²ç«™)
           ========================================= */
        :root {
            /* ä¸»å“ç‰Œè‰² (å»ºè­°ï¼šç¶²ç«™çš„æ¨™é¡Œé¡è‰²æˆ–Headeråº•è‰²) */
            --brand-color: #2c3e50;  /* ç›®å‰é è¨­ï¼šæ·±è—ç° */
            
            /* å¼·èª¿è‰² (å»ºè­°ï¼šé»ƒè‰²åœ“åœˆçš„é¡è‰²) */
            --accent-color: #f1c40f; /* ç›®å‰é è¨­ï¼šäº®é»ƒ */
            
            /* èƒŒæ™¯è‰² */
            --bg-color: #f8f9fa;     /* ç›®å‰é è¨­ï¼šç°ç™½ */
            
            /* æ–‡å­—é¡è‰² */
            --text-color: #333333;
            
            /* åŠŸèƒ½è‰² (æˆåŠŸ/å¤±æ•—) */
            --success: #27ae60;
            --danger: #e74c3c;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            font-family: 'Noto Sans TC', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-color);
            overflow: hidden; /* é˜²æ­¢æ²å‹• */
        }

        /* --- Header (Heroå€) --- */
        header {
            background-color: white; /* è‹¥æ‚¨çš„ç¶²ç«™ Header æ˜¯æœ‰é¡è‰²çš„ï¼Œè«‹æ”¹é€™è£¡ */
            padding: 10px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: 70px;
            z-index: 100;
        }

        .brand-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* é»ƒè‰²åœ“åœˆ */
        .logo-circle {
            width: 42px;
            height: 42px;
            background-color: var(--accent-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 900;
            color: var(--brand-color);
            font-size: 1.1rem;
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--accent-color);
        }

        .brand-text {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--brand-color);
            letter-spacing: 0.5px;
        }

        .nav-group {
            display: flex;
            gap: 10px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--brand-color);
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.95rem;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .nav-link:hover {
            background-color: var(--brand-color);
            color: white;
        }

        /* --- ä¸»ç•«é¢å®¹å™¨ --- */
        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        /* å¡ç‰‡åˆ‡æ›æ•ˆæœ */
        .screen {
            display: none;
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
            animation: fadeIn 0.4s ease-out;
            position: relative;
        }

        .screen.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- é€šç”¨å…ƒä»¶ --- */
        h2 {
            color: var(--brand-color);
            font-size: 1.8rem;
            margin-bottom: 25px;
            font-weight: 700;
        }

        p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn {
            background-color: var(--brand-color);
            color: white;
            border: none;
            padding: 12px 35px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            margin: 8px;
        }

        .btn:hover { transform: translateY(-2px); }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        
        .btn-outline {
            background: white;
            border: 2px solid var(--brand-color);
            color: var(--brand-color);
            box-shadow: none;
        }
        .btn-outline:hover { background: var(--bg-color); }

        .btn-accent {
            background-color: var(--accent-color);
            color: var(--brand-color);
            box-shadow: 0 4px 0 #d4ac0d;
        }

        input[type="text"] {
            width: 80%;
            max-width: 400px;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 12px;
            text-align: center;
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--brand-color); }

        /* --- é—œå¡é¸æ“‡ç¶²æ ¼ --- */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .level-card {
            background: #f1f3f5;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .level-card:hover { transform: translateY(-5px); }
        
        .level-card.selected {
            border-color: var(--brand-color);
            background: #e8f4fd;
        }

        .level-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .level-title { font-weight: bold; color: var(--brand-color); }

        /* --- é›£åº¦é¸æ“‡ --- */
        .diff-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .diff-btn {
            padding: 10px 25px;
            border-radius: 20px;
            border: 2px solid #ccc;
            background: white;
            color: #888;
            font-weight: bold;
            cursor: pointer;
        }
        .diff-btn.selected {
            background: var(--brand-color);
            color: white;
            border-color: var(--brand-color);
        }

        /* --- éŠæˆ²ä»‹é¢ --- */
        .game-header {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #555;
        }

        .hud-val { color: var(--brand-color); font-size: 1.3rem; margin-left: 5px; }

        /* æ™‚é–“æ¢ */
        .timer-track {
            width: 100%; height: 10px; background: #e9ecef; border-radius: 5px;
            overflow: hidden; margin-bottom: 25px;
        }
        .timer-fill {
            height: 100%; background: var(--success); width: 100%;
            transition: width 1s linear, background-color 0.3s;
        }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls-top {
            position: absolute;
            top: 20px; right: 20px;
            display: flex; gap: 8px;
        }
        .icon-btn {
            width: 35px; height: 35px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }
        .icon-btn:hover { background: var(--brand-color); color: white; border-color: var(--brand-color); }

        /* é¡Œç›®å€ */
        .question-box {
            font-size: 1.4rem;
            line-height: 1.5;
            color: var(--text-color);
            margin-bottom: 30px;
            min-height: 80px;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }
        .highlight { color: var(--brand-color); background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 4px; }

        /* é¸é …å€ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .opt-btn {
            background: white;
            border: 2px solid #e9ecef;
            padding: 20px;
            font-size: 1.25rem;
            font-weight: bold;
            color: #555;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .opt-btn:hover { border-color: var(--brand-color); color: var(--brand-color); }
        .opt-btn:active { transform: scale(0.98); }

        /* ç‰¹æ•ˆèˆ‡å‹•ç•« */
        .combo-effect {
            position: absolute;
            top: 15%; right: 5%;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--accent-color);
            text-shadow: 2px 2px 0 var(--brand-color);
            opacity: 0;
            pointer-events: none;
            transform: scale(0.5) rotate(-15deg);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .combo-effect.show { opacity: 1; transform: scale(1.2) rotate(-15deg); }

        /* å½ˆçª— Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center; align-items: center;
            z-index: 999;
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 20px;
            width: 90%; max-width: 450px; text-align: center;
            animation: popUp 0.3s;
        }
        @keyframes popUp { from{transform:scale(0.8);opacity:0;} to{transform:scale(1);opacity:1;} }

        /* æ’è¡Œæ¦œåˆ—è¡¨ */
        .leader-item {
            display: flex; justify-content: space-between;
            padding: 12px; border-bottom: 1px solid #eee;
        }
        .leader-item:nth-child(1) { color: #d4ac0d; font-weight: bold; } /* é‡‘ */
        .leader-item:nth-child(2) { color: #7f8c8d; font-weight: bold; } /* éŠ€ */
        .leader-item:nth-child(3) { color: #d35400; font-weight: bold; } /* éŠ… */

    </style>
</head>
<body>

    <header>
        <div class="brand-container">
            <div class="logo-circle">æˆ‘</div>
            <div class="brand-text">Jessie Math</div>
        </div>
        <nav class="nav-group">
            <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-link">é¦–é </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-link">éŠæˆ²å¤§å»³</a>
        </nav>
    </header>

    <main>

        <div id="screen-start" class="screen active">
            <h2>ğŸ‘‹ æ­¡è¿ä¾†åˆ°æ¯”ä¾‹å°ºå¤§æŒ‘æˆ°</h2>
            <p>è«‹è¼¸å…¥æ‚¨çš„åå­—ä»¥é–‹å§‹æŒ‘æˆ°ï¼</p>
            <input type="text" id="username" placeholder="è«‹è¼¸å…¥åå­—..." maxlength="10">
            <br><br>
            <button class="btn" onclick="goSelectLevel()">ä¸‹ä¸€æ­¥</button>
        </div>

        <div id="screen-level" class="screen">
            <h2>ğŸš€ é¸æ“‡ä½ çš„æŒ‘æˆ°</h2>
            
            <div class="level-grid">
                <div class="level-card selected" onclick="selectLevel(1, this)">
                    <span class="level-icon">ğŸ”</span>
                    <span class="level-title">ç¬¬1é—œï¼šæ”¾å¤§</span>
                </div>
                <div class="level-card" onclick="selectLevel(2, this)">
                    <span class="level-icon">ğŸ”¬</span>
                    <span class="level-title">ç¬¬2é—œï¼šç¸®å°</span>
                </div>
                <div class="level-card" onclick="selectLevel(3, this)">
                    <span class="level-icon">ğŸ—ºï¸</span>
                    <span class="level-title">ç¬¬3é—œï¼šæ¯”ä¾‹å°º</span>
                </div>
                <div class="level-card" onclick="selectLevel(4, this)">
                    <span class="level-icon">ğŸ¢</span>
                    <span class="level-title">ç¬¬4é—œï¼šæ··åˆ</span>
                </div>
            </div>

            <p>é¸æ“‡é€Ÿåº¦ (é›£åº¦)ï¼š</p>
            <div class="diff-group">
                <div class="diff-btn selected" id="diff-normal" onclick="setDiff('normal')">æ™®é€š (60ç§’)</div>
                <div class="diff-btn" id="diff-hard" onclick="setDiff('hard')">æ¥µé€Ÿ (45ç§’)</div>
            </div>

            <button class="btn btn-accent" onclick="showRules()">é–‹å§‹éŠæˆ²</button>
        </div>

        <div id="screen-game" class="screen">
            <div class="controls-top">
                <div class="icon-btn" onclick="quitGame()" title="å›åˆ°é¸å–®">â†©</div>
                <div class="icon-btn" onclick="pauseGame()" title="æš«åœ">â¸</div>
                <div class="icon-btn" onclick="restartGame()" title="é‡æ–°é–‹å§‹">ğŸ”„</div>
            </div>

            <div class="game-header">
                <div>é—œå¡: <span id="hud-level" class="hud-val">1</span></div>
                <div>åˆ†æ•¸: <span id="hud-score" class="hud-val">0</span></div>
                <div>æ™‚é–“: <span id="hud-time" class="hud-val">60</span></div>
            </div>

            <div class="timer-track">
                <div class="timer-fill" id="timer-bar"></div>
            </div>

            <div class="combo-effect" id="combo-text">COMBO!</div>

            <div class="question-box" id="q-text">
                é¡Œç›®è¼‰å…¥ä¸­...
            </div>

            <div class="options-grid" id="opt-container">
                </div>
        </div>

        <div id="screen-result" class="screen">
            <h2>ğŸ‰ æŒ‘æˆ°çµæŸ</h2>
            <p>ç©å®¶ï¼š<strong id="res-name"></strong></p>
            <h1 style="font-size: 3.5rem; color: var(--accent-color); margin: 10px 0;" id="res-score">0</h1>
            <p id="res-msg">è©•èª...</p>
            <button class="btn" onclick="showLeaderboard()">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
            <button class="btn btn-outline" onclick="goSelectLevel()">å†ç©ä¸€æ¬¡</button>
        </div>

        <div id="screen-rank" class="screen">
            <h2>ğŸ† æ¦®è­½æ¦œ</h2>
            <div id="rank-list" style="text-align: left; background: #fafafa; padding: 10px; border-radius: 10px; height: 250px; overflow-y: auto;">
                </div>
            <br>
            <button class="btn" onclick="goSelectLevel()">è¿”å›</button>
        </div>

    </main>

    <div id="modal-rules" class="modal">
        <div class="modal-content">
            <h3>ğŸ“œ éŠæˆ²è¦å‰‡</h3>
            <ul style="text-align: left; color: #555; line-height: 1.8;">
                <li>é™æ™‚æŒ‘æˆ°ï¼Œç­”å°é¡Œç›® <b>+5ç§’</b>ã€‚</li>
                <li><b>Comboé€£æ“Š</b>ï¼šé€£çºŒç­”å°åˆ†æ•¸æœƒåŠ å€ï¼</li>
                <li>ç­”éŒ¯æœƒæ‰£é™¤æ™‚é–“ (5ç§’)ã€‚</li>
                <li>æ¥µé€Ÿæ¨¡å¼ä¸‹ï¼Œåˆå§‹æ™‚é–“è¼ƒå°‘ï¼ŒæŒ‘æˆ°ä½ çš„åæ‡‰é€Ÿåº¦ã€‚</li>
            </ul>
            <button class="btn" onclick="realStart()">æˆ‘æº–å‚™å¥½äº†ï¼</button>
        </div>
    </div>

    <div id="modal-pause" class="modal">
        <div class="modal-content">
            <h3>â¸ éŠæˆ²æš«åœ</h3>
            <button class="btn" onclick="resumeGame()">ç¹¼çºŒéŠæˆ²</button>
            <button class="btn btn-outline" onclick="quitGame()">é€€å‡ºé—œå¡</button>
        </div>
    </div>

    <script>
        // --- éŠæˆ²è³‡æ–™èˆ‡ç‹€æ…‹ ---
        const Game = {
            user: "ç©å®¶",
            level: 1, // 1,2,3,4
            diff: 'normal', // normal, hard
            score: 0,
            time: 60,
            maxTime: 60,
            combo: 0,
            timerId: null,
            isPlaying: false,
            curAns: null
        };

        const DB = {
            ranks: JSON.parse(localStorage.getItem('jessie_scale_rank') || '[]')
        };

        // --- å°èˆªæ§åˆ¶ ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.modal').forEach(el => el.style.display = 'none');
        }

        function goSelectLevel() {
            const name = document.getElementById('username').value.trim();
            if(!name && !Game.user) { alert("è«‹è¼¸å…¥åå­—"); return; }
            if(name) Game.user = name;
            switchScreen('screen-level');
        }

        // --- è¨­å®šèˆ‡é¸å–® ---
        function selectLevel(lvl, el) {
            Game.level = lvl;
            document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }

        function setDiff(d) {
            Game.diff = d;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('diff-' + d).classList.add('selected');
        }

        function showRules() {
            document.getElementById('modal-rules').style.display = 'flex';
        }

        // --- éŠæˆ²æ ¸å¿ƒé‚è¼¯ ---
        function realStart() {
            switchScreen('screen-game');
            Game.score = 0;
            Game.combo = 0;
            // è¨­å®šé›£åº¦æ™‚é–“
            Game.maxTime = (Game.diff === 'hard') ? 45 : 60;
            Game.time = Game.maxTime;
            Game.isPlaying = true;

            updateHUD();
            nextQuestion();
            
            if(Game.timerId) clearInterval(Game.timerId);
            Game.timerId = setInterval(loop, 1000);
        }

        function loop() {
            if(!Game.isPlaying) return;
            Game.time--;
            updateHUD();
            if(Game.time <= 0) gameOver();
        }

        function updateHUD() {
            document.getElementById('hud-score').innerText = Game.score;
            document.getElementById('hud-time').innerText = Game.time;
            document.getElementById('hud-level').innerText = (Game.level===4)?'æ··åˆ':Game.level;
            
            const pct = Math.max(0, (Game.time / Game.maxTime) * 100);
            const bar = document.getElementById('timer-bar');
            bar.style.width = pct + "%";
            if(pct < 30) bar.style.backgroundColor = "var(--danger)";
            else bar.style.backgroundColor = "var(--success)";
        }

        function nextQuestion() {
            // æ ¹æ“šé—œå¡èˆ‡é›£åº¦å‡ºé¡Œ
            let type = Game.level;
            if(type === 4) type = Math.floor(Math.random() * 3) + 1;
            
            let qStr = "";
            let ans = 0;
            let opts = [];
            let suffix = "";

            // è¼”åŠ©å‡½å¼
            const rnd = (min,max) => Math.floor(Math.random()*(max-min+1))+min;

            if(type === 1) { // æ”¾å¤§
                const base = rnd(2, 10);
                const rate = rnd(2, 5);
                if(Math.random()>0.5) {
                    qStr = `é‚Šé•· ${base} cm çš„æ­£æ–¹å½¢ï¼Œ<span class="highlight">æ”¾å¤§ ${rate} å€</span>å¾Œï¼Œæ–°é‚Šé•·æ˜¯å¤šå°‘ï¼Ÿ`;
                    ans = base * rate;
                    suffix = "cm";
                } else {
                    qStr = `é•· ${base} cm æ”¾å¤§å¾Œè®Šæˆ ${base*rate} cmï¼Œè«‹å•æ˜¯<span class="highlight">æ”¾å¤§å¹¾å€</span>ï¼Ÿ`;
                    ans = rate;
                    suffix = "å€";
                }
            } else if(type === 2) { // ç¸®å°
                const rate = rnd(2, 5); // ç¸®å°ç‚º 1/rate
                const res = rnd(2, 8);
                const org = res * rate;
                qStr = `é•·åº¦ ${org} cmï¼Œ<span class="highlight">ç¸®å°ç‚ºåŸæœ¬çš„ 1/${rate}</span>ï¼Œæ–°é•·åº¦æ˜¯å¤šå°‘ï¼Ÿ`;
                ans = res;
                suffix = "cm";
            } else { // æ¯”ä¾‹å°º
                // Map : Real
                const map = rnd(2, 8);
                const scale = (Game.diff==='hard') ? rnd(1,5)*100000 : rnd(1,5)*100; // Hard: km, Normal: m
                
                if(scale >= 100000) { // km
                    const km = (map * scale) / 100000;
                    qStr = `åœ°åœ–æ¯”ä¾‹å°º 1 : ${scale}ã€‚<br>åœ°åœ–ä¸Š ${map} cmï¼Œå¯¦éš›è·é›¢æ˜¯å¹¾å…¬é‡Œï¼Ÿ`;
                    ans = km;
                    suffix = "km";
                } else { // m
                    const m = (map * scale) / 100;
                    qStr = `åœ°åœ–æ¯”ä¾‹å°º 1 : ${scale}ã€‚<br>åœ°åœ–ä¸Š ${map} cmï¼Œå¯¦éš›è·é›¢æ˜¯å¹¾å…¬å°ºï¼Ÿ`;
                    ans = m;
                    suffix = "m";
                }
            }

            Game.curAns = ans;
            
            // ç”¢ç”Ÿå¹²æ“¾é¸é …
            let set = new Set([ans]);
            while(set.size < 4) {
                let fake = ans + rnd(-5, 5);
                if(fake <= 0) fake = ans * 2;
                if(fake !== ans) set.add(fake);
            }
            opts = Array.from(set).sort(()=>Math.random()-0.5);

            // æ¸²æŸ“
            document.getElementById('q-text').innerHTML = qStr;
            const container = document.getElementById('opt-container');
            container.innerHTML = "";
            opts.forEach(o => {
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.innerHTML = o + (suffix ? ` <small>${suffix}</small>` : "");
                btn.onclick = () => check(o);
                container.appendChild(btn);
            });
        }

        function check(val) {
            if(!Game.isPlaying) return;
            if(val === Game.curAns) {
                // ç­”å°
                Game.combo++;
                let pts = 100 + (Game.combo * 20);
                if(Game.diff === 'hard') pts = Math.floor(pts * 1.5);
                Game.score += pts;
                Game.time = Math.min(Game.maxTime, Game.time + 5); // çå‹µæ™‚é–“
                showCombo();
                nextQuestion();
            } else {
                // ç­”éŒ¯
                Game.combo = 0;
                Game.time -= 5; // æ‡²ç½°
                updateHUD();
                // éœ‡å‹•ç‰¹æ•ˆ
                const box = document.getElementById('q-text');
                box.style.borderLeft = "5px solid var(--danger)";
                setTimeout(()=>box.style.borderLeft="none", 200);
                nextQuestion();
            }
        }

        function showCombo() {
            if(Game.combo < 2) return;
            const el = document.getElementById('combo-text');
            el.innerText = `COMBO x${Game.combo}`;
            el.classList.add('show');
            setTimeout(()=>el.classList.remove('show'), 800);
        }

        // --- éŠæˆ²æ§åˆ¶ ---
        function pauseGame() {
            Game.isPlaying = false;
            document.getElementById('modal-pause').style.display = 'flex';
        }

        function resumeGame() {
            Game.isPlaying = true;
            document.getElementById('modal-pause').style.display = 'none';
        }

        function quitGame() {
            if(confirm("ç¢ºå®šè¦æ”¾æ£„ç›®å‰çš„é€²åº¦å—ï¼Ÿ")) {
                clearInterval(Game.timerId);
                goSelectLevel();
            }
        }

        function restartGame() {
            if(confirm("é‡æ–°é–‹å§‹æœ¬å±€ï¼Ÿ")) {
                clearInterval(Game.timerId);
                realStart();
            }
        }

        // --- çµç®—èˆ‡æ’è¡Œ ---
        function gameOver() {
            clearInterval(Game.timerId);
            Game.isPlaying = false;
            switchScreen('screen-result');
            
            document.getElementById('res-name').innerText = Game.user;
            document.getElementById('res-score').innerText = Game.score;
            
            let msg = "å†æ¥å†å²ï¼";
            if(Game.score > 1000) msg = "è¡¨ç¾ä¸éŒ¯å–”ï¼";
            if(Game.score > 3000) msg = "å¤ªç¥å•¦ï¼æ¯”ä¾‹å°ºå¤§å¸«ï¼";
            document.getElementById('res-msg').innerText = msg;

            // å„²å­˜ç´€éŒ„
            DB.ranks.push({name: Game.user, score: Game.score, date: new Date().toLocaleDateString()});
            DB.ranks.sort((a,b) => b.score - a.score);
            DB.ranks = DB.ranks.slice(0, 10); // åªç•™å‰10
            localStorage.setItem('jessie_scale_rank', JSON.stringify(DB.ranks));
        }

        function showLeaderboard() {
            switchScreen('screen-rank');
            const list = document.getElementById('rank-list');
            list.innerHTML = "";
            
            if(DB.ranks.length === 0) {
                list.innerHTML = "<div style='text-align:center;color:#999;padding:20px;'>æš«ç„¡ç´€éŒ„</div>";
                return;
            }

            DB.ranks.forEach((r, i) => {
                const item = document.createElement('div');
                item.className = 'leader-item';
                let medal = (i===0)?'ğŸ¥‡ ':(i===1)?'ğŸ¥ˆ ':(i===2)?'ğŸ¥‰ ': `${i+1}. `;
                item.innerHTML = `<span>${medal}${r.name}</span> <span>${r.score}åˆ†</span>`;
                list.appendChild(item);
            });
        }

    </script>
</body>
</html>